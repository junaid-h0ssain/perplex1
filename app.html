<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>HarvestGuard</title>
  <link rel="stylesheet" href="./src/style.css" />
  <!-- Firebase SDKs -->
  <script type="module" src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js"></script>
</head>

<body>
  <div id="app">

    <section id="auth-section">
      <!-- LOGIN CARD (default visible) -->
      <div id="login-card" class="card">
        <h2>Login</h2>
        <h4><a href="/">Back to home page</a></h4>
        <form id="login-form">
          <input type="email" id="login-email" placeholder="Email" required />
          <input type="password" id="login-password" placeholder="Password" required />
          <button type="submit" class="btn btn-primary">Login</button>
        </form>

        <p class="divider">Or</p>

        <!-- phone + OTP (UI only for now) -->
        <form id="phone-login-form">
          <input type="tel" id="login-phone" placeholder="+880123456789" />
          <button type="button" id="send-otp-btn" class="btn btn-dark">Send OTP</button>
        </form>

        <p class="divider">Or Google Login</p>
        <button type="button" id="google-login-btn" class="btn btn-google">
          Login with Google
        </button>

        <p class="divider">Or</p>
        <button type="button" id="reset-password-btn" class="btn btn-dark">
          Forgot Password?
        </button>

        <button id="show-register" class="link-btn">
          Create account
        </button>
      </div>

      <!-- REGISTER CARD (hidden by default) -->
      <div id="register-card" class="card hidden">
        <h2>Register</h2>
        <form id="register-form">
          <input type="text" id="reg-name" placeholder="Full name" required />
          <input type="email" id="reg-email" placeholder="Email" required />
          <input type="password" id="reg-password" placeholder="Password" required />
          <input type="tel" id="reg-phone" placeholder="Phone" />
          <select id="reg-language">
            <option value="en">English</option>
            <option value="bn">বাংলা</option>
          </select>
          <button type="submit" class="btn btn-primary">Sign up</button>
        </form>

        <button id="show-login" class="link-btn">
          Back to login
        </button>
      </div>
    </section>


    <!-- Main App -->
    <section id="main-section" class="hidden">
      <nav id="top-nav">
        <span id="app-title">HarvestGuard</span>
        <div>
          <select id="language-select">
            <option value="en">English</option>
            <option value="bn">বাংলা</option>
          </select>
          <button id="nav-dashboard">Dashboard</button>
          <button id="nav-weather">Weather</button>
          <button id="nav-ai-scanner">AI Scanner</button>
          <button id="nav-profile">Profile</button>
          <button id="logout-btn">Logout</button>
        </div>
      </nav>

      <!-- Dashboard -->
      <section id="dashboard-view">
        <h2 id="dash-title">Dashboard</h2>

        <div id="analytics">
          <div>Active batches: <span id="stat-active">0</span></div>
          <div>Completed batches: <span id="stat-completed">0</span></div>
          <div>Mitigated risks: <span id="stat-mitigated">0</span></div>
          <div>Total weight (kg): <span id="stat-weight">0</span></div>
        </div>

        <h3>Create batch</h3>
        <form id="batch-form">
          <input id="batch-crop" placeholder="Crop type" required />
          <input id="batch-weight" type="number" step="0.01" placeholder="Weight (kg)" required />
          <input id="batch-date" type="date" required />
          <select id="batch-storage" required>
            <option value="">Select storage type</option>
            <option value="Jute Bag Stack">Jute Bag Stack</option>
            <option value="Silo">Silo</option>
            <option value="Open Area">Open Area</option>
          </select>
          <select id="batch-location" required></select>
          <label>
            Image:
            <input id="batch-image" type="file" accept="image/*" />
          </label>
          <button type="submit">Add batch</button>
        </form>

        <h3>Active batches</h3>
        <div id="active-batches"></div>
        <div id="no-batches-msg" class="hidden">No active batches.</div>

        <h3>Badges</h3>
        <ul id="badges-list"></ul>
        <div id="no-badges-msg" class="hidden">No badges earned yet.</div>

        <h3>Risk alerts</h3>
        <div id="alerts-container"></div>

        <h3>Export data</h3>
        <button id="export-btn">Export JSON + CSV</button>
      </section>

      <!-- Weather View -->
      <section id="weather-view" class="hidden">
        <h2>আবহাওয়া ও পরামর্শ (Weather & Advisory)</h2>

        <div class="weather-controls">
          <label for="weather-location">এলাকা নির্বাচন করুন (Select Area):</label>
          <select id="weather-location">
            <option value="">-- নির্বাচন করুন --</option>
            <!-- Options will be populated by JS -->
          </select>
        </div>

        <div id="weather-panel" class="weather-grid">
          <!-- Weather cards will go here -->
          <p>দয়া করে একটি এলাকা নির্বাচন করুন।</p>
        </div>
      </section>

      <!-- AI Scanner -->
      <section id="ai-scanner-view" class="hidden">
        <h2 id="scanner-title">Crop Health Scanner (AI)</h2>
        <p id="scanner-subtitle" class="text-sm text-gray-600 mb-4">
          ফসলের ছবি তুলুন বা আপলোড করুন, সিস্টেম বলবে ফসলটি Fresh নাকি Rotten।
        </p>

        <div class="space-y-3">
          <input id="ai-scan-input" type="file" accept="image/*" capture="environment"
            class="w-full border rounded px-3 py-2 text-sm" />

          <button id="ai-scan-button" class="btn btn-primary w-full text-sm" type="button">
            Scan crop health
          </button>

          <p id="ai-scan-status" class="text-xs text-gray-600"></p>

          <div class="flex items-start gap-3 mt-2">
            <img id="ai-scan-preview" class="w-24 h-24 object-cover rounded border hidden"
              alt="Selected crop photo preview" />
            <div class="flex-1">
              <p class="text-sm font-medium">Result</p>
              <p id="ai-scan-result" class="text-sm"></p>
            </div>
          </div>
        </div>
      </section>

      <!-- Profile -->
      <section id="profile-view" class="hidden">
        <h2>Profile</h2>

        <!-- Profile Picture Section -->
        <div id="profile-picture-section" style="margin-bottom: 24px; padding: 16px; border: 1px solid #e0e0e0; border-radius: 8px;">
          <h3>Profile Picture</h3>
          <div style="display: flex; gap: 16px; align-items: flex-start;">
            <div style="flex-shrink: 0;">
              <img id="profile-picture" 
                style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; background-color: #f0f0f0;"
                alt="Profile picture" />
              <p id="no-picture-text" style="text-align: center; color: #999; font-size: 12px; margin-top: 8px;">No picture</p>
            </div>
            <div>
              <input id="profile-picture-input" type="file" accept="image/*" style="display: none;" />
              <button id="upload-picture-btn" type="button" class="btn btn-primary" style="margin-bottom: 8px;">
                Upload Picture
              </button>
              <button id="remove-picture-btn" type="button" class="btn btn-dark" style="display: none;">
                Remove Picture
              </button>
              <p id="upload-status" style="font-size: 12px; color: #666; margin-top: 8px;"></p>
            </div>
          </div>
        </div>

        <!-- Profile Info Display -->
        <div id="profile-display">
          <p>Name: <span id="profile-name"></span></p>
          <p>Email: <span id="profile-email"></span></p>
          <p>Phone: <span id="profile-phone"></span></p>
          <p>Bio: <span id="profile-bio"></span></p>
          <p>Created: <span id="profile-created"></span></p>
        </div>

        <h3>Edit profile</h3>
        <form id="profile-form">
          <input id="edit-name" placeholder="Name" />
          <input id="edit-phone" placeholder="Phone" />
          <textarea id="edit-bio" placeholder="Short bio"></textarea>
          <button type="submit">Save profile</button>
        </form>

        <h3>Change password</h3>
        <form id="password-form">
          <input id="current-password" type="password" placeholder="Current password" required />
          <input id="new-password" type="password" placeholder="New password" required />
          <button type="submit">Update password</button>
        </form>
      </section>
    </section>

  </div>

  <script type="module" src="./src/firebase-config.js"></script>
  <script type="module" src="./src/config.js"></script>
  <script type="module" src="./src/main.js"></script>
</body>

</html>